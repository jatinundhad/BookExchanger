<% layout('Layout/boilerplate') -%>
    <div class="container">
        <% if(!buyer){ %>
            <p class="text-center alert alert-primary" role="alert">Contact this seller for buying this book</p>
            <% }else{ %>
                <p class="text-center alert alert-primary" role="alert">Book already bought.</p>
                <% } %>
    </div>
    <div class="d-flex justify-content-center flex-wrap my-3">
        <div class=" card m-3" style="width: 20rem; min-width: 250px; height: fit-content;">

            <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <% book.images.map((image,i)=> { %>
                        <div class="carousel-item <%= i === 0 ? 'active' : ''%>">
                            <img src="<%= image.path %>" class="d-block w-100 card-img-top" alt="image">
                        </div>
                        <% }) %>
                </div>
                <% if(book.images.length !==1){ %>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                    <% } %>
            </div>

            <div class="card-body">
                <h5 class="card-title">Book Title: <%= book.title %>
                </h5>
                <p class="card-text">Topic: <%= book.topic %>
                </p>
                <p class="card-text">Author Name: <%= book.author %>
                </p>
                <p class="card-text">Published Year: <%= book.year %>
                </p>
                <p class="card-text">ISBN No.: <%= book.isbn %>
                </p>
                <p class="card-text" id="card_price" style="font-weight: bolder; font-size: larger;">Price : â‚¹
                    <%= book.price %>
                </p>
                <% if(currentUser && !currentUser._id.equals(profile._id) && !buyer) {%>
                    <form action="/buybook/<%= book._id %>/buyer/<%= currentUser._id %>?_method=PUT" method="POST">
                        <button type="submit" href="/book/<%= book._id %>" class="btn btn-primary shadow-lg ">Buy This
                            Book</button>
                    </form>
                    <% } %>
                        <% if(currentUser && currentUser._id.equals(profile._id) && !buyer){ %>
                            <form style="display: inline-block;"
                                action="/book/<%= book._id %>/user/<%= profile._id %>?_method=DELETE" , method="POST">
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                            <% } %>
            </div>
        </div>

        <div class="d-flex justify-content-center mt-3" id="Seller-info" style="height: fit-content; max-width: 90%">
            <div class="card shadow" style="font-size: 20px;">
                <div class="card-header">
                    <h5 class="card-text" style="font-weight: 700; font-size:25px;">Seller Information</h5>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="card-text list-group-item">Name : <%= profile.name.firstName + " " +
                            profile.name.lastName%>
                    </li>
                    <li class="card-text list-group-item">Contact No : +91 <%= profile.phoneNo%>
                    </li>
                    <li class="card-text list-group-item">Email Id : <%= profile.email%>
                    </li>
                    <li class="card-text list-group-item">City : <%= address.city%>
                    </li>
                    <li class="card-text list-group-item">Country : <%= address.country %>
                    </li>
                </ul>
                <% if(buyer){ %>
                    <div class="card-header">
                        <h5 class="card-text" style="font-weight: 700; font-size:25px;">Buyer Information</h5>
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="card-text list-group-item">Name : <%= buyer.name.firstName + " " +
                                buyer.name.lastName%>
                        </li>
                        <li class="card-text list-group-item">Contact No : +91 <%= buyer.phoneNo %>
                        </li>
                        <li class="card-text list-group-item">Email Id : <%= buyer.email%>
                        </li>
                        <li class="card-text list-group-item">City : <%= buyer.address.city %>
                        </li>
                        <li class="card-text list-group-item">Country : <%= buyer.address.country %>
                        </li>
                    </ul>
                    <% } %>
            </div>
        </div>
    </div>